<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="shortcut icon" type="../static/img/logo" href="../static/img/logo/logo_short.png">
  
  <title>Flood Safe Home</title>
      <!-- CSS here -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/css/owl.carousel.min.css">
    <link rel="stylesheet" href="static/css/slicknav.css">
    <link rel="stylesheet" href="static/css/flaticon.css">
    <link rel="stylesheet" href="static/css/progressbar_barfiller.css">
    <link rel="stylesheet" href="static/css/gijgo.css">
    <link rel="stylesheet" href="static/css/animate.min.css">
    <link rel="stylesheet" href="static/css/animated-headline.css">
    <link rel="stylesheet" href="static/css/magnific-popup.css">
    <link rel="stylesheet" href="static/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="static/css/themify-icons.css">
    <link rel="stylesheet" href="static/css/slick.css">
    <link rel="stylesheet" href="static/css/nice-select.css">
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <style>
     #viewDiv {
      height: 90%;
      width: 69%;
      float: right;
    }
    #left{
      height: 80%;
      width: 30%;
      float: left;
    }
    #left1{
      height: 62%;
      width: 100%;
      margin: 5px 5px 5px 5px;
    }
        #left2{
      height: 28%;
      width: 100%;
      margin: 5px 5px 5px 5px;
    }
        #left3{
      height: 10%;
      width: 100%;
      margin: 5px 5px 5px 5px;
    }

  </style>



<link rel="stylesheet" href="https://js.arcgis.com/4.17/esri/themes/light/main.css">
<script src="https://js.arcgis.com/4.17/"></script>

<script>
      require([
        "esri/WebMap",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/widgets/Search",
        "esri/widgets/LayerList",
        "esri/widgets/Legend",
        "esri/widgets/Expand",
        "esri/widgets/BasemapToggle"
      ], function (WebMap, MapView, FeatureLayer, Search, LayerList, Legend, Expand, BasemapToggle) {
        const map = new WebMap({
          portalItem: {
            id: "d61a90015054449484e1bd332a3b75e2"
          }
        });

        // Add the map to a MapView
        const view = new MapView({
          container: "viewDiv",
          map: map
        });

        // Add the feature layer to search the location based on the address
        var featureLayerAddress = new FeatureLayer({
          url:
            "https://services2.arcgis.com/njxlOVQKvDzk10uN/arcgis/rest/services/ADDRESS/FeatureServer",
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "{FullAddress}",
            overwriteActions: true
          }
        });

         // Add the feature layer to search the location based on the parcel
        var featureLayerParcel = new FeatureLayer({
          url:
            "https://services2.arcgis.com/njxlOVQKvDzk10uN/arcgis/rest/services/PARCEL/FeatureServer",
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Parcel ID is {SITE_ID}",
            overwriteActions: true
          }
        });


        // Search widget start
        var searchWidget = new Search({
          view: view,
          allPlaceholder:{{location|safe}}, //"type an address",//,
          //value:{{location|safe}},
          sources: [
            {
              layer: featureLayerAddress,         // Search by address
              searchFields:  ["FullAddress"],
              displayField: "FullAddress",
              exactMatch: false,
              outFields: ["FullAddress"],
              placeholder: "example: 1107 LAIR AVE",
              name: "Address",
              zoomScale: 500,
              resultSymbol: {
                r: 178,
                g: 34,
                b: 34,
                a: 0.7
              }
            },

            {
              layer: featureLayerParcel,         // Search by parcel
              searchFields: ["SITE_ID"],
              displayField: "SITE_ID",
              exactMatch: false,
              outFields: ["SITE_ID"],
              name: "Parcel",
              placeholder: "example: M-1686"
            }
          ]

       // console.log(document.getElementById("submitButton"))
        //document.getElementById("submitButton").onclick = (e)=> {
       // e.preventDefault()
      //  let el = document.getElementById("tags")
       // console.log(el.value)
     //   searchWidget.search(el.value).then((result)=> {
      //  console.log("result", result)
      //   })
     //   }
   // }); 

 //  var searchWidget = new Search{view: view1})
//function mySubmitFunction () {
 // let element = document.getElementById("tags")
 // let address = {{location|safe}}//element.value

 // searchWidget.search(address).then((results) => {
   //  console.log("Search widget results :", results)
  //})
//})

   });

        // Add the search widget to the top left corner of the view
        view.ui.add(searchWidget, {
          position: "top-right"
        });

          

        // Search widget end


        // Add a legend instance to the panel of a
        // ListItem in a LayerList instance
        const layerList = new LayerList({
          view: view,
          listItemCreatedFunction: function (event) {
            const item = event.item;
            if (item.layer.type != "group") {
              // don't show legend twice
              item.panel = {
                content: "legend",
                open: false
              };
            }
          }
        });
        view.ui.add(layerList, "top-right");

        //Basemap toggle
        var toggle = new BasemapToggle({
          view: view, // view that provides access to the map's 'topo-vector' basemap
          nextBasemap: "hybrid" // allows for toggling to the 'hybrid' basemap
        });

        // Add widget to the bottom right corner of the view
        view.ui.add(toggle, "bottom-right");

      });
  </script>
</head>



<body>
  <header class="header" style="background-color:#367FFF; height:100px; text">
		<a href="/"><img src="../static/img/logo/logo.png" alt=""></a>
 
	</header>
  <!-- .header end-->
  

  <!-- autosuggestion-->
   

    <script> 
    jQuery.noConflict();
    jQuery(function ($) {    
    
    $( "#tags" ).autocomplete({
      source: "{% url 'autosuggest' %}"
        });
     } );
     
    </script>
   <!--autosuggestion End-->

  <div id="left"> <!-- .left div tags-->
    <div id="left1"><!-- .left1: User's input-->
      <form method="get" action="/search">
           <!--
            {% csrf_token %} 
            -->
            {% csrf_token %} 
      <p> 
        <h2><center><b> Select your building information</b></center> </h2>
         <div class="select-form">
          <div class="select-itms">
           <b> &nbsp; # stories </b>                       
                <select name="stories" id="stories">
                    <option disabled="true" selected> --select no of stories--</option>
                    <option value="0">None</option>
                    <option value="1">1 story</option>
                    <option value="2">2 stories</option>
                    <option value="3">3 stories</option>
                    <option value="4">4 stories</option>
                </select>

        <br><br>
        <b> &nbsp; Address or Parcel ID </b> &nbsp;&nbsp; <input type="text"  name="location"  id="tags" value={{location|safe}}> <!-- placeholder={{location|safe}}  "Type your address/parce ID"-->
        &nbsp; &nbsp; &nbsp; &nbsp; 
          
        <br><br>
        <b> &nbsp; Square footage </b> &nbsp;&nbsp; <input type="text"  name="sqft"  id="sqft" placeholder="Type your building's square footage"-->
        &nbsp; &nbsp; &nbsp; &nbsp; 
         

        <br><br>
        <b> &nbsp; Construction types </b><br>
      
            <table align = "center" >
              <tr align = "center"> <!--input-->
                <td><label><input type="radio" name="fruit" value="basement"></label></td>
                <td><label><input type="radio" name="fruit" value="crawlSpace"> </label></td>
                <td><label><input type="radio" name="fruit" value="slab"></label></td>
                <td><label><input type="radio" name="fruit" value="pierBeamPiling"> </label></td>
                <td><label><input type="radio" name="fruit" value="pierBeamPilingFreeboard"></label></td>
              </tr>
              <tr align = "center"> <!--image-->
                <td><br><img src="../static/img/construction/basement.png" style="width: 50px; height:50px;"></td>
                <td><br><img src="../static/img/construction/crawlSpace.png" style="width: 50px; height:50px;"></td>
                <td><br><img src="../static/img/construction/slab.png" style="width: 50px; height:50px;"></td>
                <td><br><img src="../static/img/construction/pierBeamPiling.png" style="width: 50px; height:50px;"></td>
                <td><br><img src="../static/img/construction/pierBeamPilingFreeboard.png" style="width: 50px; height:50px;"></td> 
              <tr align = "center">
                <td>Basement</td>
                <td>Crawl space</td>
                <td>Slab</td>
                <td><br>Pier and <br>beam piling</td>
                <td><br><br>Pier and <br>beam piling with <br>freeboard</td>
              </tr>
            </table>
        
        <button class="btn btn-primary" type="submit" id="submitButton"> Run</button>     
      </form>
      </p>
    </div>
  


<!-- Error message-->                                
{% if messages %}
{% for message in messages %}
<div class="alert {{ message.tags }} alert-dismissible fade show my-0" role="alert">
  <strong>{{ message }}</strong>
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endfor %}
{% endif %}

<!-- Error message ends--> 

 </div>
</div>
    <!-- left2: Chart-->
			<div id="left2">
      <h2><center> <b>Freeboard and Benefit Graph </b></center> </h2>
				{{ div | safe }}
			</div>

</div>
  <!--
    <div id="left2"> <- left2: Chart->
      <div class="col-md-6">
				<div >
					<div class="progress-wrap">
						<h3><span class="name-left">Freeboard Construction Cost​</span><span class="value-right">
                     <ul class="submenu">
                        <li>For BFE+1: &#36;{{construction_cost_BFE1}}</li>
                        <li>For BFE+2: &#36;{{construction_cost_BFE2}}</li>
                        <li>For BFE+3: &#36;{{construction_cost_BFE3}}</li>
                        <li>For BFE+4: &#36;{{construction_cost_BFE4}}</li>
                    </ul>
                    </span></h3>
          

          
          
          	<div class="progress">


						  <div class="progress-bar progress-bar-1 progress-bar-striped active" role="progressbar"
						  aria-valuenow="90" aria-valuemin="0" aria-valuemax="100" style="width:50%"> <-width part will be updated based on the calcuation->
						  </div>
						</div>
					</div>
					<div class="progress-wrap">
						<h3><span class="name-left">Estimated Flood Insurance Premiums/yr</span><span class="value-right">
          <ul class="submenu">
                        <li>For BFE+0: &#36;{{Premium_BFE0}}</li>
                        <li>For BFE+1: &#36;{{Premium_BFE1}}</li>
                        <li>For BFE+2: &#36;{{Premium_BFE2}}</li>
                        <li>For BFE+3: &#36;{{Premium_BFE3}}</li>
                        <li>For BFE+4: &#36;{{Premium_BFE4}}</li>
                    </ul>
              </span></h3>


						<div class="progress">
						  <div class="progress-bar progress-bar-2 progress-bar-striped active" role="progressbar"
						  aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width:80%">
						  </div>
						</div>
					</div>
					<div class="progress-wrap">
						<h3><span class="name-left">Annual Benefit​</span><span class="value-right">XX</span></h3>
						<div class="progress">
						  <div class="progress-bar progress-bar-6 progress-bar-striped active" role="progressbar"
						  aria-valuenow="85" aria-valuemin="0" aria-valuemax="100" style="width:85%">
						  </div>
						</div>
					</div>
					<div class="progress-wrap">
						<h3><span class="name-left">Payback Periods of Freeboard Construction Cost</span><span class="value-right">XX</span></h3>
						<div class="progress">
						  <div class="progress-bar progress-bar-3 progress-bar-striped active" role="progressbar"
						  aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width:75%">
						  </div>
						</div>
					</div>
					<div class="progress-wrap">
						<h3><span class="name-left">Net Benefit​ (NB)​</span><span class="value-right">XX</span></h3>
						<div class="progress">
						  <div class="progress-bar progress-bar-4 progress-bar-striped active" role="progressbar"
						  aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:70%">
						  </div>
						</div>
					</div>
					<div class="progress-wrap">
						<h3><span class="name-left">Net Benefit Cost Ratio (NBCR)​</span><span class="value-right">XX</span></h3>
						<div class="progress">
						  <div class="progress-bar progress-bar-5 progress-bar-striped active" role="progressbar"
						  aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width:80%">
						  </div>
						</div>
					</div>
        </div>
    </div>      
    </div>

-->

<!-- .left3: Hazard calculator
    <div id="left3"> 
    <p> <br>
        <center><h2> Flood Hazard Calculator </h2>
                <label for="slider-fill">Select Annual Change ____</label>
                <input name="slider-fill" id="slider-fill" type="range" min="0" max="100" step="5" value="0" data-highlight="true"><br><br>
                <label for="slider-fill">Select Duration  ____</label>
                <input name="slider-fill" id="slider-fill" type="range" min="0" max="100" step="1" value="0" data-highlight="true"><br>
                <h4><label for="slider-fill">Likelihood of flooding is ____</label></h4><br><br></center>
    </p>
    </div>
 
  </div>
   -->


  <div id="viewDiv">
  
  </div>

    <script type="text/javascript" src="http://cdn.pydata.org/bokeh/release/bokeh-2.2.1.min.js"></script>
    <script type="text/javascript" src="http://cdn.pydata.org/bokeh/release/bokeh-widgets-2.2.1.min.js"></script>
    <script type="text/javascript" src="http://cdn.pydata.org/bokeh/release/bokeh-tables-2.2.1.min.js"></script>
    <script type="text/javascript" src="http://cdn.pydata.org/bokeh/release/bokeh-api-2.2.1.min.js"></script> 
    {{script | safe}}


    <!--<script src="http://code.jquery.com/jquery-1.6.1.min.js"></script> -->
</body>
</html>
